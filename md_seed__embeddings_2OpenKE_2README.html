<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IR2Vec: OpenKE</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">IR2Vec
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">OpenKE</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md50"></a>An Open-source Framework for Knowledge Embedding.</p>
<p>More information is available on our website <a href="http://openke.thunlp.org/">http://openke.thunlp.org/</a></p>
<p>If you use the code, please cite the following <a href="http://aclweb.org/anthology/D18-2024">paper</a>:</p>
<div class="fragment"><div class="line">@inproceedings{han2018openke,</div>
<div class="line">  title={{OpenKE}: An Open Toolkit for Knowledge Embedding},</div>
<div class="line">  author={Han, Xu and Cao, Shulin and Lv Xin and Lin, Yankai and Liu, Zhiyuan and Sun, Maosong and Li, Juanzi},</div>
<div class="line">  booktitle={Proceedings of EMNLP},</div>
<div class="line">  year={2018}</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md51"></a>
Overview</h1>
<p>This is an Efficient implementation based on TensorFlow for knowledge representation learning (KRL). We use C++ to implement some underlying operations such as data preprocessing and negative sampling. For each specific model, it is implemented by TensorFlow with Python interfaces so that there is a convenient platform to run models on GPUs. OpenKE composes 4 repositories:</p>
<p>OpenKE: the main project based on TensorFlow, which provides the optimized and stable framework for knowledge graph embedding models.</p>
<p><a href="https://github.com/thunlp/OpenKE/tree/OpenKE-PyTorch">OpenKE-PyTorch</a>: OpenKE implemented with PyTorch, also providing the optimized and stable framework for knowledge graph embedding models.</p>
<p><a href="https://github.com/thunlp/TensorFlow-TransX">TensorFlow-TransX</a>: light and simple version of OpenKE based on TensorFlow, including TransE, TransH, TransR and TransD.</p>
<p><a href="https://github.com/thunlp/Fast-TransX">Fast-TransX</a>: efficient lightweight C++ inferences for TransE and its extended models utilizing the framework of OpenKE, including TransH, TransR, TransD, TranSparse and PTransE.</p>
<h1><a class="anchor" id="autotoc_md52"></a>
Installation</h1>
<ol type="1">
<li>Install TensorFlow</li>
<li>Clone the OpenKE repository:</li>
</ol>
<div class="fragment"><div class="line">$ git clone https://github.com/thunlp/OpenKE</div>
<div class="line">$ cd OpenKE</div>
</div><!-- fragment --><ol type="1">
<li>Compile C++ files</li>
</ol>
<div class="fragment"><div class="line">$ bash make.sh</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md53"></a>
Data</h1>
<ul>
<li><p class="startli">For training, datasets contain three files:</p>
<p class="startli">train2id.txt: training file, the first line is the number of triples for training. Then the following lines are all in the format <em><b>(e1, e2, rel)</b></em> which indicates there is a relation <em><b>rel</b></em> between <em><b>e1</b></em> and <em><b>e2</b></em> . <b>Note that train2id.txt contains ids from entitiy2id.txt and relation2id.txt instead of the names of the entities and relations. If you use your own datasets, please check the format of your training file. Files in the wrong format may cause segmentation fault.</b></p>
<p class="startli">entity2id.txt: all entities and corresponding ids, one per line. The first line is the number of entities.</p>
<p class="startli">relation2id.txt: all relations and corresponding ids, one per line. The first line is the number of relations.</p>
</li>
<li><p class="startli">For testing, datasets contain additional two files (totally five files):</p>
<p class="startli">test2id.txt: testing file, the first line is the number of triples for testing. Then the following lines are all in the format <em><b>(e1, e2, rel)</b></em> .</p>
<p class="startli">valid2id.txt: validating file, the first line is the number of triples for validating. Then the following lines are all in the format <em><b>(e1, e2, rel)</b></em> .</p>
<p class="startli">type_constrain.txt: type constraining file, the first line is the number of relations. Then the following lines are type constraints for each relation. For example, the relation with id 1200 has 4 types of head entities, which are 3123, 1034, 58 and 5733. The relation with id 1200 has 4 types of tail entities, which are 12123, 4388, 11087 and 11088. You can get this file through <b>n-n.py</b> in folder benchmarks/FB15K.</p>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md54"></a>
Quick Start</h1>
<h2><a class="anchor" id="autotoc_md55"></a>
Training</h2>
<p>To compute a knowledge graph embedding, first import datasets and set configure parameters for training, then train models and export results. For instance, we write an example_train_transe.py to train TransE:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> config</div>
<div class="line"><span class="keyword">import</span> models</div>
<div class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"> </div>
<div class="line">con = <a class="code hl_class" href="classconfig_1_1Config_1_1Config.html">config.Config</a>()</div>
<div class="line"><span class="comment">#Input training files from benchmarks/FB15K/ folder.</span></div>
<div class="line">con.set_in_path(<span class="stringliteral">&quot;./benchmarks/FB15K/&quot;</span>)</div>
<div class="line"> </div>
<div class="line">con.set_work_threads(4)</div>
<div class="line">con.set_train_times(500)</div>
<div class="line">con.set_nbatches(100)</div>
<div class="line">con.set_alpha(0.001)</div>
<div class="line">con.set_margin(1.0)</div>
<div class="line">con.set_bern(0)</div>
<div class="line">con.set_dimension(50)</div>
<div class="line">con.set_ent_neg_rate(1)</div>
<div class="line">con.set_rel_neg_rate(0)</div>
<div class="line">con.set_opt_method(<span class="stringliteral">&quot;SGD&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment">#Models will be exported via tf.Saver() automatically.</span></div>
<div class="line">con.set_export_files(<span class="stringliteral">&quot;./res/model.vec.tf&quot;</span>, 0)</div>
<div class="line"><span class="comment">#Model parameters will be exported to json files automatically.</span></div>
<div class="line">con.set_out_files(<span class="stringliteral">&quot;./res/embedding.vec.json&quot;</span>)</div>
<div class="line"><span class="comment">#Initialize experimental settings.</span></div>
<div class="line">con.init()</div>
<div class="line"><span class="comment">#Set the knowledge embedding model</span></div>
<div class="line">con.set_model(<a class="code hl_class" href="classmodels_1_1TransE_1_1TransE.html">models.TransE</a>)</div>
<div class="line"><span class="comment">#Train the model.</span></div>
<div class="line">con.run()</div>
<div class="ttc" id="aclassconfig_1_1Config_1_1Config_html"><div class="ttname"><a href="classconfig_1_1Config_1_1Config.html">config.Config.Config</a></div><div class="ttdef"><b>Definition</b> Config.py:11</div></div>
<div class="ttc" id="aclassmodels_1_1TransE_1_1TransE_html"><div class="ttname"><a href="classmodels_1_1TransE_1_1TransE.html">models.TransE.TransE</a></div><div class="ttdef"><b>Definition</b> TransE.py:7</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md56"></a>
Step 1: Import datasets</h3>
<div class="fragment"><div class="line">con.set_in_path(<span class="stringliteral">&quot;benchmarks/FB15K/&quot;</span>)</div>
</div><!-- fragment --><p>We import knowledge graphs from benchmarks/FB15K/ folder. The data consists of three essential files mentioned before:</p>
<ul>
<li>train2id.txt</li>
<li>entity2id.txt</li>
<li>relation2id.txt</li>
</ul>
<p>Validation and test files are required and used to evaluate the training results, However, they are not indispensable for training.</p>
<div class="fragment"><div class="line">con.set_work_threads(8)</div>
</div><!-- fragment --><p>We can allocate several threads to sample positive and negative cases.</p>
<h3><a class="anchor" id="autotoc_md57"></a>
Step 2: Set configure parameters for training.</h3>
<div class="fragment"><div class="line">con.set_train_times(500)</div>
<div class="line">con.set_nbatches(100)</div>
<div class="line">con.set_alpha(0.5)</div>
<div class="line">con.set_dimension(200)</div>
<div class="line">con.set_margin(1)</div>
</div><!-- fragment --><p>We set essential parameters, including the data traversing rounds, learning rate, batch size, and dimensions of entity and relation embeddings.</p>
<div class="fragment"><div class="line">con.set_bern(0)</div>
<div class="line">con.set_ent_neg_rate(1)</div>
<div class="line">con.set_rel_neg_rate(0)</div>
</div><!-- fragment --><p>For negative sampling, we can corrupt entities and relations to construct negative triples. set_bern(0) will use the traditional sampling method, and set_bern(1) will use the method in (Wang et al. 2014) denoted as "bern".</p>
<div class="fragment"><div class="line">con.set_optimizer(<span class="stringliteral">&quot;SGD&quot;</span>)</div>
</div><!-- fragment --><p>We can select a proper gradient descent optimization algorithm to train models.</p>
<h3><a class="anchor" id="autotoc_md58"></a>
Step 3: Export results</h3>
<div class="fragment"><div class="line">con.set_export_files(<span class="stringliteral">&quot;./res/model.vec.tf&quot;</span>, 0)</div>
<div class="line"> </div>
<div class="line">con.set_out_files(<span class="stringliteral">&quot;./res/embedding.vec.json&quot;</span>)</div>
</div><!-- fragment --><p>Models will be exported via tf.Saver() automatically every few rounds. Also, model parameters will be exported to json files finally.</p>
<h3><a class="anchor" id="autotoc_md59"></a>
Step 4: Train models</h3>
<div class="fragment"><div class="line">con.init()</div>
<div class="line">con.set_model(<a class="code hl_class" href="classmodels_1_1TransE_1_1TransE.html">models.TransE</a>)</div>
<div class="line">con.run()</div>
</div><!-- fragment --><p>We set the knowledge graph embedding model and start the training process.</p>
<h2><a class="anchor" id="autotoc_md60"></a>
Testing</h2>
<h3><a class="anchor" id="autotoc_md61"></a>
Link Prediction</h3>
<p>Link prediction aims to predict the missing h or t for a relation fact triple (h, r, t). In this task, for each position of missing entity, the system is asked to rank a set of candidate entities from the knowledge graph, instead of only giving one best result. For each test triple (h, r, t), we replace the head/tail entity by all entities in the knowledge graph, and rank these entities in descending order of similarity scores calculated by score function fr. we use two measures as our evaluation metric:</p>
<ul>
<li><em><b>MR</b></em> : mean rank of correct entities;</li>
<li><em><b>MRR</b></em>: the average of the reciprocal ranks of correct entities;</li>
<li>***Hit@N*** : proportion of correct entities in top-N ranked entities.</li>
</ul>
<h3><a class="anchor" id="autotoc_md62"></a>
Triple Classification</h3>
<p><a class="el" href="structTriple.html">Triple</a> classification aims to judge whether a given triple (h, r, t) is correct or not. This is a binary classification task. For triple classification, we set a relationspecific threshold δr. For a triple (h, r, t), if the dissimilarity score obtained by fr is below δr, the triple will be classified as positive, otherwise negative. δr is optimized by maximizing classification accuracies on the validation set.</p>
<h3><a class="anchor" id="autotoc_md63"></a>
Predict Head Entity</h3>
<p>Given tail entity and relation, predict the top k possible head entities. All the objects are represented by their id.</p>
<div class="fragment"><div class="line"><span class="keyword">def </span>predict_head_entity(self, t, r, k):</div>
<div class="line">    <span class="stringliteral">r&#39;&#39;&#39;This mothod predicts the top k head entities given tail entity and relation.</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    Args:</span></div>
<div class="line"><span class="stringliteral">        t (int): tail entity id</span></div>
<div class="line"><span class="stringliteral">        r (int): relation id</span></div>
<div class="line"><span class="stringliteral">        k (int): top k head entities</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    Returns:</span></div>
<div class="line"><span class="stringliteral">        list: k possible head entity ids</span></div>
<div class="line"><span class="stringliteral">    &#39;&#39;&#39;</span></div>
<div class="line">    self.init_link_prediction()</div>
<div class="line">    <span class="keywordflow">if</span> self.importName != <span class="keywordtype">None</span>:</div>
<div class="line">        self.restore_tensorflow()</div>
<div class="line">    test_h = np.array(range(self.entTotal))</div>
<div class="line">    test_r = np.array([r] * self.entTotal)</div>
<div class="line">    test_t = np.array([t] * self.entTotal)</div>
<div class="line">    res = self.test_step(test_h, test_t, test_r).reshape(-1).argsort()[:k]</div>
<div class="line">    print(res)</div>
<div class="line">    <span class="keywordflow">return</span> res</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md64"></a>
Predict Tail Entity</h3>
<p>This is similar to predicting the head entity.</p>
<h3><a class="anchor" id="autotoc_md65"></a>
Predict Relation</h3>
<p>Given the head entity and tail entity, predict the top k possible relations. All the objects are represented by their id.</p>
<div class="fragment"><div class="line"><span class="keyword">def </span>predict_relation(self, h, t, k):</div>
<div class="line">    <span class="stringliteral">r&#39;&#39;&#39;This methods predict the relation id given head entity and tail entity.</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    Args:</span></div>
<div class="line"><span class="stringliteral">        h (int): head entity id</span></div>
<div class="line"><span class="stringliteral">        t (int): tail entity id</span></div>
<div class="line"><span class="stringliteral">        k (int): top k relations</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    Returns:</span></div>
<div class="line"><span class="stringliteral">        list: k possible relation ids</span></div>
<div class="line"><span class="stringliteral">    &#39;&#39;&#39;</span></div>
<div class="line">    self.init_link_prediction()</div>
<div class="line">    <span class="keywordflow">if</span> self.importName != <span class="keywordtype">None</span>:</div>
<div class="line">        self.restore_tensorflow()</div>
<div class="line">    test_h = np.array([h] * self.relTotal)</div>
<div class="line">    test_r = np.array(range(self.relTotal))</div>
<div class="line">    test_t = np.array([t] * self.relTotal)</div>
<div class="line">    res = self.test_step(test_h, test_t, test_r).reshape(-1).argsort()[:k]</div>
<div class="line">    print(res)</div>
<div class="line">    <span class="keywordflow">return</span> res</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md66"></a>
Predict triple</h3>
<p>Given a triple (h, r, t), this funtion tells us whether the triple is correct or not. If the threshold is not given, this function calculates the threshold for the relation from the valid dataset.</p>
<div class="fragment"><div class="line"><span class="keyword">def </span>predict_triple(self, h, t, r, thresh = None):</div>
<div class="line">    <span class="stringliteral">r&#39;&#39;&#39;This method tells you whether the given triple (h, t, r) is correct of wrong</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    Args:</span></div>
<div class="line"><span class="stringliteral">        h (int): head entity id</span></div>
<div class="line"><span class="stringliteral">        t (int): tail entity id</span></div>
<div class="line"><span class="stringliteral">        r (int): relation id</span></div>
<div class="line"><span class="stringliteral">        thresh (fload): threshold for the triple</span></div>
<div class="line"><span class="stringliteral">    &#39;&#39;&#39;</span></div>
<div class="line">    self.init_triple_classification()</div>
<div class="line">    <span class="keywordflow">if</span> self.importName != <span class="keywordtype">None</span>:</div>
<div class="line">        self.restore_tensorflow()</div>
<div class="line">    res = self.test_step(np.array([h]), np.array([t]), np.array([r]))</div>
<div class="line">    <span class="keywordflow">if</span> thresh != <span class="keywordtype">None</span>:</div>
<div class="line">        <span class="keywordflow">if</span> res &lt; thresh:</div>
<div class="line">            print(<span class="stringliteral">&quot;triple (%d,%d,%d) is correct&quot;</span> % (h, t, r))</div>
<div class="line">        <span class="keywordflow">else</span>:</div>
<div class="line">            print(<span class="stringliteral">&quot;triple (%d,%d,%d) is wrong&quot;</span> % (h, t, r))</div>
<div class="line">        <span class="keywordflow">return</span></div>
<div class="line">    self.lib.getValidBatch(self.valid_pos_h_addr, self.valid_pos_t_addr, self.valid_pos_r_addr, self.valid_neg_h_addr, self.valid_neg_t_addr, self.valid_neg_r_addr)</div>
<div class="line">    res_pos = self.test_step(self.valid_pos_h, self.valid_pos_t, self.valid_pos_r)</div>
<div class="line">    res_neg = self.test_step(self.valid_neg_h, self.valid_neg_t, self.valid_neg_r)</div>
<div class="line">    self.lib.getBestThreshold(self.relThresh_addr, res_pos.__array_interface__[<span class="stringliteral">&#39;data&#39;</span>][0], res_neg.__array_interface__[<span class="stringliteral">&#39;data&#39;</span>][0])</div>
<div class="line">    <span class="keywordflow">if</span> res &lt; self.relThresh[r]:</div>
<div class="line">        print(<span class="stringliteral">&quot;triple (%d,%d,%d) is correct&quot;</span> % (h, t, r))</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        print(<span class="stringliteral">&quot;triple (%d,%d,%d) is wrong&quot;</span> % (h, t, r))</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md67"></a>
Implementation</h3>
<p>To evaluate the model, first import datasets and set essential configure paramters, then set model parameters and test the model. For instance, we write an example_test_transe.py to test TransE.</p>
<p>There are four approaches to test models:</p>
<p>(1) Test models right after training.</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> config</div>
<div class="line"><span class="keyword">import</span> models</div>
<div class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">con = <a class="code hl_class" href="classconfig_1_1Config_1_1Config.html">config.Config</a>()</div>
<div class="line">con.set_in_path(<span class="stringliteral">&quot;./benchmarks/FB15K/&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment">#True: Input test files from the same folder.</span></div>
<div class="line">con.set_test_triple_classification(<span class="keyword">True</span>)</div>
<div class="line">con.set_test_link_prediction(<span class="keyword">True</span>)</div>
<div class="line"> </div>
<div class="line">con.set_work_threads(4)</div>
<div class="line">con.set_train_times(500)</div>
<div class="line">con.set_nbatches(100)</div>
<div class="line">con.set_alpha(0.001)</div>
<div class="line">con.set_margin(1.0)</div>
<div class="line">con.set_bern(0)</div>
<div class="line">con.set_dimension(50)</div>
<div class="line">con.set_ent_neg_rate(1)</div>
<div class="line">con.set_rel_neg_rate(0)</div>
<div class="line">con.set_opt_method(<span class="stringliteral">&quot;SGD&quot;</span>)</div>
<div class="line">con.set_export_files(<span class="stringliteral">&quot;./res/model.vec.tf&quot;</span>, 0)</div>
<div class="line">con.set_out_files(<span class="stringliteral">&quot;./res/embedding.vec.json&quot;</span>)</div>
<div class="line">con.init()</div>
<div class="line">con.set_model(<a class="code hl_class" href="classmodels_1_1TransE_1_1TransE.html">models.TransE</a>)</div>
<div class="line">con.run()</div>
<div class="line"> </div>
<div class="line"><span class="comment">#To test link prediction after training needs &quot;set_test_link_prediction True)&quot;.</span></div>
<div class="line"><span class="comment">#To test triple classfication after training needs &quot;set_test_triple_classification(True)&quot;</span></div>
<div class="line">con.test()</div>
</div><!-- fragment --><p>(2) Set import files and OpenKE will automatically load models via tf.Saver().</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> config</div>
<div class="line"><span class="keyword">import</span> models</div>
<div class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> json</div>
<div class="line"> </div>
<div class="line">con = <a class="code hl_class" href="classconfig_1_1Config_1_1Config.html">config.Config</a>()</div>
<div class="line">con.set_in_path(<span class="stringliteral">&quot;./benchmarks/FB15K/&quot;</span>)</div>
<div class="line">con.set_test_link_prediction(<span class="keyword">True</span>)</div>
<div class="line">con.set_test_triple_classification(<span class="keyword">True</span>)</div>
<div class="line">con.set_work_threads(4)</div>
<div class="line">con.set_dimension(50)</div>
<div class="line">con.set_import_files(<span class="stringliteral">&quot;./res/model.vec.tf&quot;</span>)</div>
<div class="line">con.init()</div>
<div class="line">con.set_model(<a class="code hl_class" href="classmodels_1_1TransE_1_1TransE.html">models.TransE</a>)</div>
<div class="line">con.test()</div>
</div><!-- fragment --><p>(3) Read model parameters from json files and manually load parameters.</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> config</div>
<div class="line"><span class="keyword">import</span> models</div>
<div class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> json</div>
<div class="line"> </div>
<div class="line">con = <a class="code hl_class" href="classconfig_1_1Config_1_1Config.html">config.Config</a>()</div>
<div class="line">con.set_in_path(<span class="stringliteral">&quot;./benchmarks/FB15K/&quot;</span>)</div>
<div class="line">con.set_test_link_prediction(<span class="keyword">True</span>)</div>
<div class="line">con.set_test_triple_classification(<span class="keyword">True</span>)</div>
<div class="line">con.set_work_threads(4)</div>
<div class="line">con.set_dimension(50)</div>
<div class="line">con.init()</div>
<div class="line">con.set_model(<a class="code hl_class" href="classmodels_1_1TransE_1_1TransE.html">models.TransE</a>)</div>
<div class="line">f = open(<span class="stringliteral">&quot;./res/embedding.vec.json&quot;</span>, <span class="stringliteral">&quot;r&quot;</span>)</div>
<div class="line">content = json.loads(f.read())</div>
<div class="line">f.close()</div>
<div class="line">con.set_parameters(content)</div>
<div class="line">con.test()</div>
</div><!-- fragment --><p>(4) Manually load models via tf.Saver().</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> config</div>
<div class="line"><span class="keyword">import</span> models</div>
<div class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> json</div>
<div class="line"> </div>
<div class="line">con = <a class="code hl_class" href="classconfig_1_1Config_1_1Config.html">config.Config</a>()</div>
<div class="line">con.set_in_path(<span class="stringliteral">&quot;./benchmarks/FB15K/&quot;</span>)</div>
<div class="line">con.set_test_link_prediction(<span class="keyword">True</span>)</div>
<div class="line">con.set_test_triple_classification(<span class="keyword">True</span>)</div>
<div class="line">con.set_work_threads(4)</div>
<div class="line">con.set_dimension(50)</div>
<div class="line">con.init()</div>
<div class="line">con.set_model(<a class="code hl_class" href="classmodels_1_1TransE_1_1TransE.html">models.TransE</a>)</div>
<div class="line">con.import_variables(<span class="stringliteral">&quot;./res/model.vec.tf&quot;</span>)</div>
<div class="line">con.test()</div>
</div><!-- fragment --><p>Note that you can only load model parameters when model configuration finished.</p>
<h2><a class="anchor" id="autotoc_md68"></a>
Getting the embedding matrix</h2>
<p>There are four approaches to get the embedding matrix.</p>
<p>(1) Set import files and OpenKE will automatically load models via tf.Saver().</p>
<div class="fragment"><div class="line">con = <a class="code hl_class" href="classconfig_1_1Config_1_1Config.html">config.Config</a>()</div>
<div class="line">con.set_in_path(<span class="stringliteral">&quot;./benchmarks/FB15K/&quot;</span>)</div>
<div class="line">con.set_test_link_prediction(<span class="keyword">True</span>)</div>
<div class="line">con.set_test_triple_classification(<span class="keyword">True</span>)</div>
<div class="line">con.set_work_threads(4)</div>
<div class="line">con.set_dimension(50)</div>
<div class="line">con.set_import_files(<span class="stringliteral">&quot;./res/model.vec.tf&quot;</span>)</div>
<div class="line">con.init()</div>
<div class="line">con.set_model(<a class="code hl_class" href="classmodels_1_1TransE_1_1TransE.html">models.TransE</a>)</div>
<div class="line"><span class="comment"># Get the embeddings (numpy.array)</span></div>
<div class="line">embeddings = con.get_parameters(<span class="stringliteral">&quot;numpy&quot;</span>)</div>
<div class="line"><span class="comment"># Get the embeddings (python list)</span></div>
<div class="line">embeddings = con.get_parameters()</div>
</div><!-- fragment --><p>(2) Read model parameters from json files and manually load parameters.</p>
<div class="fragment"><div class="line">con = <a class="code hl_class" href="classconfig_1_1Config_1_1Config.html">config.Config</a>()</div>
<div class="line">con.set_in_path(<span class="stringliteral">&quot;./benchmarks/FB15K/&quot;</span>)</div>
<div class="line">con.set_test_link_prediction(<span class="keyword">True</span>)</div>
<div class="line">con.set_test_triple_classification(<span class="keyword">True</span>)</div>
<div class="line">con.set_work_threads(4)</div>
<div class="line">con.set_dimension(50)</div>
<div class="line">con.init()</div>
<div class="line">con.set_model(<a class="code hl_class" href="classmodels_1_1TransE_1_1TransE.html">models.TransE</a>)</div>
<div class="line">f = open(<span class="stringliteral">&quot;./res/embedding.vec.json&quot;</span>, <span class="stringliteral">&quot;r&quot;</span>)</div>
<div class="line">embeddings = json.loads(f.read())</div>
<div class="line">f.close()</div>
</div><!-- fragment --><p>(3) Manually load models via tf.Saver().</p>
<div class="fragment"><div class="line">con = <a class="code hl_class" href="classconfig_1_1Config_1_1Config.html">config.Config</a>()</div>
<div class="line">con.set_in_path(<span class="stringliteral">&quot;./benchmarks/FB15K/&quot;</span>)</div>
<div class="line">con.set_test_link_prediction(<span class="keyword">True</span>)</div>
<div class="line">con.set_test_triple_classification(<span class="keyword">True</span>)</div>
<div class="line">con.set_work_threads(4)</div>
<div class="line">con.set_dimension(50)</div>
<div class="line">con.init()</div>
<div class="line">con.set_model(<a class="code hl_class" href="classmodels_1_1TransE_1_1TransE.html">models.TransE</a>)</div>
<div class="line">con.import_variables(<span class="stringliteral">&quot;./res/model.vec.tf&quot;</span>)</div>
<div class="line"><span class="comment"># Get the embeddings (numpy.array)</span></div>
<div class="line">embeddings = con.get_parameters(<span class="stringliteral">&quot;numpy&quot;</span>)</div>
<div class="line"><span class="comment"># Get the embeddings (python list)</span></div>
<div class="line">embeddings = con.get_parameters()</div>
</div><!-- fragment --><p>(4) Immediately get the embeddings after training the model.</p>
<div class="fragment"><div class="line">...</div>
<div class="line">...</div>
<div class="line">...</div>
<div class="line"><span class="comment">#Models will be exported via tf.Saver() automatically.</span></div>
<div class="line">con.set_export_files(<span class="stringliteral">&quot;./res/model.vec.tf&quot;</span>, 0)</div>
<div class="line"><span class="comment">#Model parameters will be exported to json files automatically.</span></div>
<div class="line">con.set_out_files(<span class="stringliteral">&quot;./res/embedding.vec.json&quot;</span>)</div>
<div class="line"><span class="comment">#Initialize experimental settings.</span></div>
<div class="line">con.init()</div>
<div class="line"><span class="comment">#Set the knowledge embedding model</span></div>
<div class="line">con.set_model(<a class="code hl_class" href="classmodels_1_1TransE_1_1TransE.html">models.TransE</a>)</div>
<div class="line"><span class="comment">#Train the model.</span></div>
<div class="line">con.run()</div>
<div class="line"><span class="comment">#Get the embeddings (numpy.array)</span></div>
<div class="line">embeddings = con.get_parameters(<span class="stringliteral">&quot;numpy&quot;</span>)</div>
<div class="line"><span class="comment">#Get the embeddings (python list)</span></div>
<div class="line">embeddings = con.get_parameters()</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md69"></a>
Interfaces</h1>
<h2><a class="anchor" id="autotoc_md70"></a>
Config</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>Config(object):</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To set the learning rate</span></div>
<div class="line">    <span class="keyword">def </span>set_alpha(alpha = 0.001)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To set the degree of the regularization on the parameters</span></div>
<div class="line">    def set_lmbda(lmbda = 0.0)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To set the gradient descent optimization algorithm (SGD, Adagrad, Adadelta, Adam)</span></div>
<div class="line">    <span class="keyword">def </span>set_optimizer(optimizer = &quot;SGD&quot;)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To set the data traversing rounds</span></div>
<div class="line">    def set_train_times(self, times)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To split the training triples into several batches, nbatches is the number of batches</span></div>
<div class="line">    <span class="keyword">def </span>set_nbatches(nbatches = 100)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To set the margin for the loss function</span></div>
<div class="line">    def set_margin(margin = 1.0)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To set the dimensions of the entities and relations at the same time</span></div>
<div class="line">    <span class="keyword">def </span>set_dimension(dim)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To set the dimensions of the entities</span></div>
<div class="line">    def set_ent_dimension(self, dim)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To set the dimensions of the relations</span></div>
<div class="line">    <span class="keyword">def </span>set_rel_dimension(self, dim)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To allocate threads for each batch sampling</span></div>
<div class="line">    def set_work_threads(threads = 1)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To set negative sampling algorithms, unif (bern = 0) or bern (bern = 1)</span></div>
<div class="line">    <span class="keyword">def </span>set_bern(bern = 1)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#For each positive triple, we construct rate negative triples by corrupt the entity</span></div>
<div class="line">    def set_ent_neg_rate(rate = 1)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#For each positive triple, we construct rate negative triples by corrupt the relation</span></div>
<div class="line">    <span class="keyword">def </span>set_rel_neg_rate(rate = 0)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To sample a batch of training triples, including positive and negative ones.</span></div>
<div class="line">    def sampling()</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To import dataset from the benchmark folder</span></div>
<div class="line">    <span class="keyword">def </span>set_in_path(self, path)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To export model parameters to json files when training completed</span></div>
<div class="line">    def set_out_files(self, path)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To set the import files, all parameters can be restored from the import files</span></div>
<div class="line">    <span class="keyword">def </span>set_import_files(self, path)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To set the export file of model paramters, and export results every few rounds</span></div>
<div class="line">    def set_export_files(self, path, steps = 0)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To export results every few rounds</span></div>
<div class="line">    <span class="keyword">def </span>set_export_steps(self, steps)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To save model via tf.saver</span></div>
<div class="line">    def save_tensorflow(self)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To restore model via tf.saver</span></div>
<div class="line">    <span class="keyword">def </span>restore_tensorflow(self)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To export model paramters, when path is none, equivalent to save_tensorflow()</span></div>
<div class="line">    def export_variables(self, path = <span class="keywordtype">None</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To import model paramters, when path is none, equivalent to restore_tensorflow()</span></div>
<div class="line">    <span class="keyword">def </span>import_variables(self, path = None)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To export model paramters to designated path</span></div>
<div class="line">    def save_parameters(self, path = <span class="keywordtype">None</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To manually load parameters which are read from json files</span></div>
<div class="line">    <span class="keyword">def </span>set_parameters(self, lists)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To get model paramters, if using mode &quot;numpy&quot;, you can get np.array , else you can get python lists</span></div>
<div class="line">    def get_parameters(self, mode = <span class="stringliteral">&quot;numpy&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#To set the knowledge embedding model</span></div>
<div class="line">    <span class="keyword">def </span>set_model(model)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#The framework will print loss values during training if flag = 1</span></div>
<div class="line">    def set_log_on(flag = 1)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">#This is essential when testing</span></div>
<div class="line">    <span class="keyword">def </span>set_test_link_prediction(True)</div>
<div class="line">def set_test_triple_classification(<span class="keyword">True</span>)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md71"></a>
Model</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>Model(object)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># return config which saves the training parameters.</span></div>
<div class="line">    get_config(self)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># in_batch = True, return [positive_head, positive_tail, positive_relation]</span></div>
<div class="line">    <span class="comment"># The shape of positive_head is [batch_size, 1]</span></div>
<div class="line">    <span class="comment"># in_batch = False, return [positive_head, positive_tail, positive_relation]</span></div>
<div class="line">    <span class="comment"># The shape of positive_head is [batch_size]</span></div>
<div class="line">    get_positive_instance(in_batch = <span class="keyword">True</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># in_batch = True, return [negative_head, negative_tail, negative_relation]</span></div>
<div class="line">    <span class="comment"># The shape of positive_head is [batch_size, negative_ent_rate + negative_rel_rate]</span></div>
<div class="line">    <span class="comment"># in_batch = False, return [negative_head, negative_tail, negative_relation]</span></div>
<div class="line">    <span class="comment"># The shape of positive_head is [(negative_ent_rate + negative_rel_rate) * batch_size]</span></div>
<div class="line">    get_negative_instance(in_batch = <span class="keyword">True</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># in_batch = True, return all training instances with the shape [batch_size, (1 + negative_ent_rate + negative_rel_rate)]</span></div>
<div class="line">    <span class="comment"># in_batch = False, return all training instances with the shape [(negative_ent_rate + negative_rel_rate + 1) * batch_size]</span></div>
<div class="line">    <span class="keyword">def </span>get_all_instance(in_batch = False)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># in_batch = True, return all training labels with the shape [batch_size, (1 + negative_ent_rate + negative_rel_rate)]</span></div>
<div class="line">    <span class="comment"># in_batch = False, return all training labels with the shape [(negative_ent_rate + negative_rel_rate + 1) * batch_size]</span></div>
<div class="line">    <span class="comment"># The positive triples are labeled as 1, and the negative triples are labeled as -1</span></div>
<div class="line">    def get_all_labels(in_batch = <span class="keyword">False</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># To define containers for training triples</span></div>
<div class="line">    <span class="keyword">def </span>input_def()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># To define embedding parameters for knowledge embedding models</span></div>
<div class="line">    def embedding_def()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># To define loss functions for knowledge embedding models</span></div>
<div class="line">    <span class="keyword">def </span>loss_def()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># To define the prediction functions for knowledge embedding models</span></div>
<div class="line">    def predict_def(self)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>__init__(config)</div>
<div class="line"> </div>
<div class="line"><span class="comment">#The implementation for TransE</span></div>
<div class="line">class TransE(Model)</div>
<div class="line"> </div>
<div class="line"><span class="comment">#The implementation for TransH</span></div>
<div class="line"><span class="keyword">class </span>TransH(Model)</div>
<div class="line"> </div>
<div class="line"><span class="comment">#The implementation for TransR</span></div>
<div class="line"><span class="keyword">class </span>TransR(Model)</div>
<div class="line"> </div>
<div class="line"><span class="comment">#The implementation for TransD</span></div>
<div class="line"><span class="keyword">class </span>TransD(Model)</div>
<div class="line"> </div>
<div class="line"><span class="comment">#The implementation for RESCAL</span></div>
<div class="line"><span class="keyword">class </span>RESCAL(Model)</div>
<div class="line"> </div>
<div class="line"><span class="comment">#The implementation for DistMult</span></div>
<div class="line"><span class="keyword">class </span>DistMult(Model)</div>
<div class="line"> </div>
<div class="line"><span class="comment">#The implementation for HolE</span></div>
<div class="line"><span class="keyword">class </span>HolE(Model)</div>
<div class="line"> </div>
<div class="line"><span class="comment">#The implementation for ComplEx</span></div>
<div class="line"><span class="keyword">class </span>ComplEx(Model)</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
